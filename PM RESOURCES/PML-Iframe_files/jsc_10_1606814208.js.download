var cbx={ver:1063,lp:0},lang=[],config={};cbx.isDev=!1;if(document.currentScript){var matches=document.currentScript.src.match(/_(.*)\.js/);matches&&1<matches.length&&(cbx.build=matches[1]+"",cbx.build.match(/dev/)&&(cbx.isDev=!0))}cbx.isTopLevel=window===window.parent;cbx.isSecureContext="https:"===window.location.protocol?!0:!1;
var overlay=function(){var a,b,c,e,d,f=null,g=!1,h=null,k=function(l){var n=document.body.onmousedown;a||(a=document.getElementById("overlay"),b=document.getElementById("overlayStage"),c=document.getElementById("barTitle"),e=document.getElementById("barDefault"),d=document.getElementById("barNotice"));h||(h=makeButton("ChevLeft","","",function(){k()},"btnTitle").enable());f&&(b.appendChild(f.body),f.isVisible=!1,f=null,document.body.onmousedown=n);a.innerHTML="";l?(document.body.onmousedown=function(b){b=
b.target;do if(b===a)return;while(b=b.parentElement);k()},e.className="bar Hide",d.className="bar Hide",c.className="bar",h.text(l.title),a.appendChild(l.body),l.isVisible=!0,f=l,classToggle(document.body,"WithOverlay",!0),classToggle(document.body,"Full",g)):(classToggle(document.body,"WithOverlay",!1),classToggle(document.body,"Full",!1),c.className="bar Hide",e.className="bar",d.className="bar Hide");cbx.autoScroll(!1)};return{create:function(a,b){var c=document.createElement("div");c.className=
"ovr"+b;return{body:c,isVisible:!1,title:a?a:""}},switchTo:k,getCurrent:function(){return f},setFull:function(a){f&&a!==g&&(g=a,classToggle(document.body,"WithOverlay",!0),classToggle(document.body,"Full",g))}}}(),classToggle=function(a,b,c){var e=null,d=a.className?a.className.split(" "):[],f=d.indexOf(b),g="undefined"===typeof c;-1===f||!1!==c&&!g||(d.splice(f,1),e=!1);-1!==f||!0!==c&&!g||(d.push(b),e=!0);a.className=d.join(" ");return e},classState=function(a,b){return-1!==(a.className?a.className.split(" "):
[]).indexOf(b)?!0:!1},windowIsFocused=!0,init=function(a,b){config=a;lang=b;Blank.init(config.id+"_"+config.tid);cbx.debug.log("Starting");cbx.notifyParent("loading");var c=document.forms.cbox;window.f=cbx.$frm=c;config.sno=8<window.name.length?window.name.substring(8):config.sno;cbx.refreshBtn=makeButton("Circle","","",function(){return!1},"btnRefresh");config.uon&&window.setTimeout(initOnliners,600);var e=overlay.create("Smilies","Smilies"),d=null;makeButton("Smile","","Smilies",function(a,b){var g=
function(a,b){Emotes.enqueueAll(a);var d=a.getElementsByClassName("emoteBtn");for(a=0;a<d.length;a++)(function(a){var g=d[a].getAttribute("data-code");b&&Tooltip(d[a],g,d[a]);d[a].onclick=function(){insertAtCaret(g);window.setTimeout(function(){c.pst.focus()},100)}})(a)};if(d&&!d.closed)d.focus();else if(b.shiftKey){var f=pop(location.href+"&sec=smilies",300,600,!1,function(){g(f.document)});d=f}else overlay.switchTo(e.isVisible?null:e),e.loaded||cbx.xhr("smilies",{xhr:1},null,function(a,b){e.body.innerHTML=
a;e.loaded=!0;g(document,!0)})},"btnSmilies").enable();var f=makeButton("Go","","Post",function(){c.onsubmit()},"btnSubmit").disable();c.onsubmit=function(){return do_post()};if("TEXTAREA"==c.pst.tagName.toUpperCase()){var g=function(){c.pst.scrollHeight>c.pst.offsetHeight&&c.pst.clientHeight<.5*document.body.clientHeight&&(c.pst.style.height=c.pst.scrollHeight+"px",cbx.autoScroll(!1));""==c.pst.value?(c.pst.style.height="auto",f.disable()):f.enable()};c.pst.onkeypress=function(a){g();var b=window.event&&
window.event.keyCode||a.keyCode||a.which;if((13==b||10==b)&&a.ctrlKey)return insertAtCaret("\n",!0),!0;if(13!=b)return!0;do_post()&&c.submit();return!1};c.pst.onfocus=function(a){if(a=document.getElementById("caret"))a.className="Hide";g()};c.pst.onchange=g;c.pst.onkeyup=c.pst.oninput=function(a){c.pst.value.length>config.ml&&(c.pst.value=c.pst.value.substring(0,config.ml));g()}}cbx.isTopLevel?c.pst.focus():makeButton("Pop","","Pop out",function(a){var b=pop(window.location.href,600,600,1);a.onclick(function(){b&&
!b.closed?b.focus():b=pop(window.location.href,600,600,1)})},"btnPop").enable();cbx.gsUser=cbx.getGSObject(config.id+":user");cbx.gsPrefs=cbx.getGSObject("_:prefs");c.key.value&&c.nme.value||config.uo?(cbx.gsUser.set("key",c.key.value),cbx.gsUser.set("nme",c.nme.value),cbx.gsUser.set("eml",c.eml.value),cbx.gsUser.set("pic",c.pic.value)):(c.key.value=cbx.gsUser.get("key")||"",c.nme.value=cbx.gsUser.get("nme")||"",c.eml&&(c.eml.value=cbx.gsUser.get("eml")||""),c.pic&&(c.pic.value=cbx.gsUser.get("pic")||
""));window.onbeforeunload=function(){};window.onfocus=function(){cbx.notifyParent("focus");windowIsFocused=!0;cbx.isTopLevel&&updateFavicon(0)};window.onblur=function(){cbx.notifyParent("blur");windowIsFocused=!1;cbx.isTopLevel&&messages.setBookmark()};window.onkeydown=function(a){};var h=window;cbx.lp=Math.max(cbx.lp,1*config.lpid);h.nme&&c.nme.value==lang[1]&&(c.nme.value=h.nme);h.eml&&c.eml&&c.eml.value==lang[5]&&(c.eml.value=h.eml);h.onunload=function(){h=cbx.$body=null};window.setTimeout(function(){initAudio(config.snuri)},
1200);profileBtnSetup();authBtnSetup();cbx.modBtn=makeButton("Approval","","Pending messages",function(){config.uo?pop(config.mc_uo_path,320,480,0):pop("./?"+config.rq+"&sec=modchan&n="+esc(cbx.$frm.nme.value)+"&k="+esc(cbx.$frm.key.value),320,480,0)},"btnModPop").hide();cbx.upd_tms();msgToolsUpdate();config.xp||(cbx.arMgr.onconnect=function(){cbx.presMgr.sendPing(null);window.setTimeout(function(){cbx.arMgr.haveMsgSync?cbx.debug.log("Skipping ar gap-fill: have latest msg."):cbx.xhr("ar",{p:cbx.lp},
null,function(a,b){a&&!b&&cbx.aj_proc(a)})},50)},cbx.arMgr.run());(config.uon||config.pm)&&c.key.value&&!cbx.presMgr.state&&cbx.presMgr.run();config.uon&&userViewMon.init(function(){});config.uon&2&&cbx.addTypingHandler(c.pst,function(a){cbx.presMgr.sendPing(a?"typing":"idle")});cbx.$older=document.getElementById("olderMsgs");cbx.$older&&(cbx.$older.innerHTML="&nbsp;",cbx.$older.style.height="20px");cbx.autoScroll(!0);cbx.listenParent()};
"undefined"===typeof window.JSON&&(window.JSON={parse:function(){},stringify:function(){}});
cbx.getGSObject=function(a,b){var c;try{var e=window.localStorage,d=e.getItem("cbx:"+a);if(d&&(c=JSON.parse(d))&&c.val)var f=c.val}catch(g){cbx.debug.log("[GS] get failed: "+g.name)}c||(c={});f||(f={});return{get:function(a){return f[a]},set:function(d,h){if(!f[d]||f[d]!==h||"object"===typeof h){f[d]=h;c.val=f;d=(new Date).getTime()/1E3|0;c.ctime?c.mtime=d:c.ctime=d;b&&(c.ttl=1*b);try{e.setItem("cbx:"+a,JSON.stringify(c))}catch(k){cbx.debug.log("[GS] set failed: "+k.name)}}},toString:function(){return JSON.stringify(f)}}};
cbx.notifyParent=function(a,b){window.postMessage&&(cbx.isTopLevel||window.parent.postMessage(JSON.stringify({event:""+a,data:b,serial:config.sno}),"*"))};
cbx.listenParent=function(){window.onmessage=function(a){if(!a||!a.origin||null===a.origin.match(/\.cbox\.ws$/)&&null===a.origin.match(/cbox\.im$/))cbx.debug.log("Got wrong origin "+a.origin,"PARENT");else{var b={};try{b=JSON.parse(a.data)}catch(e){cbx.debug.log("Got bad JSON","PARENT")}a=b._call;var c=b.args;cbx.debug.log("Got call "+a,"PARENT");"ruready"===a&&cbx.notifyParent("ready");if("elemFromPoint"===a){c=document.elementFromPoint(c.x,c.y);if(null===c){cbx.notifyParent(a,null);return}cbx.notifyParent(a,
c.tagName+" "+c.className)}"setStyle"===a&&(cbx.setStyle(b.sel,b.prop,b.val),cbx.debug.log("GOT SETSTYLE FOR "+b.prop,"PARENT"));"loadCSS"===a&&(cbx.loadCSS(window,"./?"+config.rq+"&sec=css&i="+b.which),cbx.debug.log("GOT loadCSS FOR "+b.which,"PARENT"));"replaceCSS"===a&&(cbx.replaceCSS(b.cssText),cbx.debug.log("GOT replaceCSS","PAR"));"type"===a&&(a=cbx.$frm,a.pst.value=a.pst.value+" "+b.message,a.pst.focus())}};cbx.notifyParent("ready")};
cbx.debug={loadTime:(new Date).getTime(),history:[],log:function(a,b){var c=cbx.debug,e=(((new Date).getTime()-cbx.debug.loadTime)/1E3).toFixed(3);c.history.push({time:e,msg:a,group:b?b:""});50<c.history.length&&c.history.shift();cbx.isDev&&console.info("%s [%s] %s",e,b,a)},stringify:function(a){if("string"===typeof a||"number"===typeof a)return a;var b=[],c;for(c in a)b.push(c+": "+a[c]);return b.join(", ")}};
cbx.debugOverlay=function(){var a=null,b=overlay.create("Debug log","Debug"),c=function(){overlay.switchTo();a&&window.clearInterval(a);a=null},e=function(){overlay.switchTo(b)},d=function(){for(var a=["<b>Version:</b>  "+cbx.ver+" build "+cbx.build+" in "+document.compatMode+"<br>","<b>Namespace:</b>  "+config.srv+"-"+config.id+"-"+config.tid+" ("+config.sno+") "+(cbx.isSecureContext?"HTTPS":"")+"<br>","<b>User Agent:</b> "+navigator.userAgent+" FP: "+cbx.fp+"<br>","<b>V state:</b> "+userViewMon.state+
" scroll lock: "+scrollFollow+" ("+JSON.stringify(userViewMon.props)+")<br>","<b>Time:</b> "+(new Date).getTime()+", since load: "+(((new Date).getTime()-cbx.debug.loadTime)/1E3).toFixed(3)+", srv adj: "+cbx.unixTime()+"<br>","<b>Prefs:</b> "+cbx.gsPrefs.toString()+"<br>","<b>User:</b> "+cbx.gsUser.toString()+"<br>","<b>ARMGR state:</b> "+cbx.arMgr.state+", adapter: "+cbx.arMgr.adapter+", endpoint: "+(cbx.arMgr.endpoint?cbx.arMgr.endpoint:"-")+", conn ID: "+cbx.arMgr.upstream+", wait: "+cbx.arMgr.backoff+
"<br>","<b>WS/FL/LP/RP state:</b> "+wsconn.state+" / "+flconn.state+" / "+cbx.lpconn.state+" / "+cbx.repl.state+"<br>","<b>Repl:</b> client "+cbx.repl.clientID+"; "+(null===cbx.repl.masterID?"MASTER":"slave of "+cbx.repl.masterID)+"<br>","<b>Presence:</b> "+cbx.presMgr.state+"<br>","<b>--- Log ---</b><br>"],d=0;d<cbx.debug.history.length;d++){var c=cbx.debug.history[d];a.push(c.time+" ["+c.group+"] "+c.msg+"<br>")}b.body.innerHTML=a.join("")};return{update:d,show:e,hide:c,toggle:function(){b&&b.isVisible?
c():(d(),e())},autorefresh:function(){c();a=window.setInterval(d,500);d();e()},getHTML:function(){d();return b.body.innerHTML}}}();cbx.cmdHistory=[];cbx.cmdCursor=0;
cbx.cmdExec=function(a){if("//"!==a.substring(0,2))return!1;var b=cbx.$frm;b.pst.onkeydown=function(a){a=a||window.event;"INPUT"!==b.pst.tagName||!cbx.cmdHistory.length||38!=a.keyCode&&40!=a.keyCode||(38==a.keyCode&&cbx.cmdCursor+1<cbx.cmdHistory.length&&(cbx.cmdHistory[cbx.cmdCursor]=b.pst.value,b.pst.value=cbx.cmdHistory[++cbx.cmdCursor]),40==a.keyCode&&cbx.cmdHistory.length&&cbx.cmdCursor&&(cbx.cmdHistory[cbx.cmdCursor]=b.pst.value,b.pst.value=cbx.cmdHistory[--cbx.cmdCursor]),a.preventDefault&&
a.preventDefault())};a!==cbx.cmdHistory[0]&&(cbx.cmdHistory[0]=a,cbx.cmdHistory.unshift(""),10<cbx.cmdHistory.length&&cbx.cmdHistory.pop());cbx.cmdCursor=0;var c={error:function(){window.setTimeout(function(){throw Error("Debug error");},1)},debug:function(a,b){"send"==a?b?(a=cbx.debugOverlay.getHTML(),statusBar.set("Sending"),cbx.xhr("senddebug",null,{tag:b,html:a},function(a,b){b?statusBar.warn(b):statusBar.set("Sent")})):statusBar.warn("Please provide tag"):"watch"==a?cbx.debugOverlay.autorefresh():
cbx.debugOverlay.toggle()},reload:function(a){if("clean"==a)try{window.localStorage.clear()}catch(f){}window.setTimeout(function(){window.location.reload(!0)},1E3*Math.random())},ping:cbx.doPing,loadcss:function(a){cbx.loadCSS(window,a)},loadsound:function(a){cbx.audio.setup(a)},tetris:function(){var a=window.open("","","width=400, height=600, resizable=yes");a.document.write('<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width, initial-scale=1.0"></head><body id="bdy" style="position:absolute;margin:0;width:100%;height:100%;"></body></html>');
a.document.close();a.document.title="TETRIS!";var b=a.document.getElementById("bdy");a.onTetrisReady=function(c){c=new c(b);a.onresize=c.redraw;a.onblur=c.pause;a.onfocus=c.resume;c.start()};var c=a.document.createElement("script");c.src="//static.cbox.ws/jsc/tetris.js?1";b.appendChild(c)},wordsearch:function(a){a=a||"";var b=cbx.gsUser.get("nme")||"";window.open("http://www.cbox.ws/games/wordsearch/?name="+esc(b)+"#"+esc(a),"","width=750, height=800, resizable=yes")},sudoku:function(){window.open("http://www.cbox.ws/games/sudoku/",
"","width=600, height=800, resizable=yes")},help:function(){var a=[],b;for(b in c)a.push(b);add_priv_post("[HELP]",a.join(", "))},pm:function(a,b){if(a||b)return!0;statusBar.warn("Usage: //pm uid message<br>Or: //pm on|off")},colors:function(){cbx.colorPicker.toggle()},ignore:function(a){var b=cbx.gsUser.get("ignores")||[];a?-1<b.indexOf(a)?(b.splice(b.indexOf(a),1),cbx.gsUser.set("ignores",b),statusBar.set("User "+a+" no longer ignored.")):(b.push(a),cbx.gsUser.set("ignores",b),statusBar.set("User "+
a+" ignored")):(a="Not ignoring anyone yet. Use: //ignore username. ",b.length&&(a="Currently ignoring: "+b.join(", ")),statusBar.set(a))},menu:function(a){cbx.notifyParent("menu",a)},quote:function(a){var b=new XMLHttpRequest;b.onload=function(a){try{var c=JSON.parse(b.responseText);for(a=0;a<c.length;a++){var d=[Math.pow(2,32)+Math.floor(1E4*Math.random()),(new Date).getTime()/1E3|0,"Date string",c[a].title,1,c[a].link,c[a].content,"",0,1234,""].join("\t");cbx.parseMsg(d)}}catch(l){}};b.open("GET",
"http://quotesondesign.com/wp-json/posts?filter[orderby]=rand&filter[posts_per_page]="+(a||1)+"&cachebust="+Math.random());b.send()},quoteloop:function(){window.setInterval(c.quote,4E3)},trim:function(a){messages.trimTail(a||0)},rdebug:function(){cbx.showRemoteDebug=!cbx.showRemoteDebug;statusBar.set("Rdebug is "+(cbx.showRemoteDebug?"ON":"OFF"))},mark:function(){messages.setBookmark()},kick:function(a){var b=cbx.$frm;cbx.xhr("delban",{n:b.nme.value,k:b.key.value,kick:a},null,function(a,b){b&&statusBar.warn(b);
if(!a)return!1;statusBar.set(a)})},pin:function(a){if(a=messages.getData(messages.getById(a)))a.isPinned=!0,insertMessage(a)}};a=a.substring(2).split(" ");var e=a[0].toLowerCase();return c[e]?!c[e].apply(window,a.slice(1)):(statusBar.warn(e+": unknown command"),!0)};
cbx.loadCSS=function(a,b){var c=a.document.getElementsByTagName("head")[0];a=a.document.createElement("link");var e=c.getElementsByTagName("link"),d;for(d in e)"text/css"===e[d].type&&c.removeChild(e[d]);a.setAttribute("rel","stylesheet");a.setAttribute("type","text/css");a.setAttribute("href",b);c.appendChild(a);window.setTimeout(function(){cbx.rsz(!0)},50)};
cbx.replaceCSS=function(a){(function(b){for(var c=0;c<b.document.styleSheets.length;c++){var e=b.document.styleSheets[c];!e.href||0>e.href.indexOf("cbox")||(e.disabled=!0)}c=b.document.getElementById("__style");c||(e=b.document.getElementsByTagName("head")[0],c=b.document.createElement("style"),c.type="text/css",c.id="__style",e.insertBefore(c,e.firstChild));c.innerHTML=a})(window);window.setTimeout(function(){cbx.rsz(!0)},50)};
cbx.setStyle=function(a,b,c){var e=[];if(a&&b){var d=new RegExp("^"+a+"$","ig");(function(a){for(var g=0;g<a.document.styleSheets.length;g++){var f=a.document.styleSheets[g];if(f.href&&!(0>f.href.indexOf("cbox"))){if(f.cssRules&&f.cssRules.length){e=f.cssRules;break}if(f.rules&&f.rules.length){e=f.rules;break}}}for(g=0;g<e.length;g++)e[g]&&e[g].selectorText&&e[g].selectorText.match(d)&&(e[g].style[b]=c)})(window);window.setTimeout(function(){cbx.rsz(!0)},50)}};
cbx.rpcCommands={del:function(a){cbx.proc_rpc_del(a)},ping:function(a){a&&add_priv_post("[PING]","Ping reply (WS/LP): "+Math.round((new Date).getTime()-1*a)+" ms")},lpid:function(a){1*a<=1*cbx.lp&&(cbx.arMgr.haveMsgSync=!0)},pm:function(a){a.split("-")[1]!==cbx.gsUser.get("uid")?(cbx.debug.log("Ignoring non-target PM "+a),deprIgnoreCount=1):(cbx.debug.log("Sent mark "+a),cbx.xhr("mark",null,{pm:a}))},mark:function(a){cbx.debug.log("Received mark for "+a);cbx.msgSetStatus(a,2)},typing:function(a){setTypingStatus(a)},
blank:function(a){window.setTimeout(function(){Blank.set(a)},2E3)},blankanon:function(a){cbx.gsUser.get("lpid")||cbx.gsUser.get("lvl")&&!(2>1*cbx.gsUser.get("lvl"))||window.setTimeout(function(){Blank.set(a)},2E3)},notice:function(a){a=a.split("\t");var b=overlay.create(a[1],"Notice");overlay.switchTo(b);b.body.textContent=a[0]},kick:function(a){a.split("\t")[0]===cbx.gsUser.get("uid")&&window.setTimeout(function(){Blank.set(0)},2E3)},arhost:function(a){a=a.split(" ");if(!((a[1]|0)/100<Math.random())){var b=
config.wsuri;config.wsuri="ws://"+a[0]+"/"+config.srv+"/";config.wsuri_https="wss://"+a[0]+"/"+config.srv+"/";config.lpuri=config.lpuri_https="//"+a[0]+"/"+config.srv+"/lp";"WS"===cbx.arMgr.adapter&&config.wsuri!==b&&window.setTimeout(function(){wsStart(cbx.isSecureContext?config.wsuri_https:config.wsuri)},1E4*Math.random())}},setlvl:function(a){a=a.split("\t");a[0]===cbx.gsUser.get("uid")&&cbx.updateUser({lvl:a[1]})},debug:function(a){cbx.debug.log(a,"R_DEBUG");cbx.showRemoteDebug&&add_priv_post("SERVER",
a)},lcmd:function(a){cbx.cmdExec("//"+a)}};var deprIgnoreCount=0;
cbx.rpcProcess=function(a,b){if("string"===typeof a&&a.length){var c=a.split("\n");window.setTimeout(function(){cbx.repl.sendmessage(a)},0);var e=cbx.rpcCommands;deprIgnoreCount=0;for(var d=!1,f=0;f<c.length;f++){var g=c[f];if(!(1>g.length)){var h="",k="";"<"==g.substring(0,1)&&(h=g.substring(1,g.indexOf("=")),k=g.substring(g.indexOf("=")+1));h?e[h]?e[h].call(window,k):b&&b(h,k):deprIgnoreCount?deprIgnoreCount--:(d=!0,cbx.parseMsg(g))}}d&&(msgToolsUpdate(),cbx.upd_tms())}};
cbx.doPing=function(){var a=(new Date).getTime();cbx.xhr("ping",{ping:a,rcid:cbx.arMgr.upstream},null,function(b,c){!b||c?"L-timeout"==c?statusBar.warn("Ping timeout"):statusBar.warn(c):(b=(new Date).getTime()-a,add_priv_post("[PING]","Ping sent OK (XHR): "+Math.round(b)+" ms"))});add_priv_post("[PING]","Ping sent")};
var relax=!1,do_refresh=function(a){cbx.autoScroll(!0);if(relax)return window.setTimeout(function(){a||statusBar.set(lang[10])},500),!1;relax=!0;window.setTimeout(function(){relax=!1},1E4);cbx.xhr("ar",{p:cbx.lp,c:cbx.unixTime()},null,function(b,c){statusBar.hide();a||(!b||c?statusBar.warn(c):cbx.aj_proc(b)||statusBar.set(lang[10]))});return!1},do_post=function(){var a=cbx.$frm,b=a.pst.value;if(cbx.cmdExec&&cbx.cmdExec(b))return cbx.setInputMode(),!1;if(!function(){if(!b)return statusBar.warn(lang[4]),
a.pst.focus(),!1;b=b.replace(/\n/g,"[br]");return config.uo?!0:a.nme.value?a.eml?""!=a.eml.value&&0>=a.eml.value.lastIndexOf(".")&&0>=a.eml.value.lastIndexOf("@")?(statusBar.warn(lang[6]),a.eml.focus(),!1):!0:!0:(statusBar.warn(lang[2]),a.nme.focus(),!1)}()||a.sub.disabled)return!1;overlay.switchTo();cbx.autoScroll(!0);cbx.setInputMode();var c=1E5*Math.random()|0;cbx.fp=0;for(var e={aj:cbx.ver,lp:cbx.lp,pst:b,fp:cbx.fp,lid:c},d="nme eml key ekey fkey pic auth captme capword caphash".split(" "),f=
0;f<d.length;f++){var g=d[f];!a[g]||""===a[g].value||"eml"==g&&a[g].value==lang[5]||(e[g]=a[g].value)}sendBuffer.add(e,c);a.pst.focus();return!1},sendBuffer=function(){function a(a){return String(a).replace(/[&<>"'\/]/g,function(a){return c[a]})}var b=[],c={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},e="idle",d=1,f=function(){if(b.length&&"idle"==e){var a=b.shift();e="sending";cbx.xhr("submit",null,a,function(c,g){e="sent";var h=c.split("\n")[0].split("\t"),k=cbx.$frm;
if(!c||h[0]||g){if(k.pst.value==lang[3]||""==k.pst.value)k.pst.value=a.pst;k=h[6];if("NEED_CAPTCHA"==k)showCaptcha();else if("NEED_LOGIN"!=k&&"MUST_REGISTER"!=k||!authBtnExtern){if(g){statusBar.error(g);return}statusBar.warn(h[0])}else authBtnExtern();if(g){e="error";window.setTimeout(function(){e="idle";f()},2E3*d);d++;return}}else d=1,cbx.gsUser.set("nme",k.nme.value),k.eml&&cbx.gsUser.set("eml",k.eml.value),k.pic&&cbx.gsUser.set("pic",k.pic.value);b.length?(e="waiting",window.setTimeout(function(){e=
"idle";f()},250)):e="idle";cbx.aj_proc(c)})}};return{add:function(c){b.push(c);insertMessage({id:"L"+c.lid,unixtime:0,datestr:"",namehtml:a(c.nme),imgurl:c.pic,exturl:c.eml,msghtml:a(c.pst),isLocal:!0});f()}}}();cbx.msgSetStatus=function(a,b){if(a=messages.getById(a)){for(var c=["","Sent","Delivered"],e=a.className.split(/\s+/),d=[c[b]],f=0;f<e.length;f++)e[f]!==c[b]&&d.push(e[f]);a.className=d.join(" ")}};
var ovrCaptcha=overlay.create("Captcha","Captcha"),showCaptcha=function(){overlay.switchTo(ovrCaptcha);cbx.xhr("captcha",{xhr:1},null,function(a,b){ovrCaptcha.body.innerHTML=a;a=document.getElementById("cthash");var c=document.getElementById("ctinput");b=document.getElementById("cttme");var e=document.forms.cbox;if("undefined"===typeof e.caphash){var d=document.createElement("input");d.name="caphash";d.type="hidden";e.appendChild(d);d=document.createElement("input");d.name="captme";d.type="hidden";
e.appendChild(d);d=document.createElement("input");d.name="capword";d.type="hidden";e.appendChild(d)}e.caphash.value=a.value;e.captme.value=b.value;e.capword.value=c.value;c.focus();c.onkeyup=function(){e.capword.value=c.value};c.onkeydown=function(a){a=a||window.event;13==(a.keyCode||a.which)&&window.do_post()}})};
cbx.aj_proc=function(a){var b=a.split("\n"),c=b[0].split("\t");if(!a)return!1;a=b.slice(1);a.length&&a.reverse();cbx.rpcProcess(a.join("\n"));c[3]&&cbx.updateUser({key:c[3]});c[2]&&(b=Math.round(1*c[2]-(new Date).getTime()/1E3))&&cbx.gsPrefs.set("timeDelta",b);c[5]&&(cbx.gsUser.set("lpid",Math.max(c[5],cbx.gsUser.get("lpid"))),cbx.msgSetStatus(c[5],1));return a.length};
cbx.updateUser=function(a){cbx.debug.log("Got user data: "+JSON.stringify(a),"UDATA");if(a&&"object"===typeof a){"key"in a&&(cbx.$frm.key.value=a.key,cbx.gsUser.set("key",a.key));"nme"in a&&a.nme&&(cbx.$frm.nme.value=a.nme,cbx.gsUser.set("nme",a.nme));"url"in a&&a.url&&(cbx.$frm.eml&&(cbx.$frm.eml.value=a.url),cbx.gsUser.set("eml",a.url));"pic"in a&&a.pic&&(cbx.$frm.pic&&(cbx.$frm.pic.value=a.pic),cbx.gsUser.set("pic",a.pic));if("uid"in a){var b=cbx.gsUser.get("uid");cbx.gsUser.set("uid",a.uid);(a.uid!=
b||!cbx.presMgr.state&&a.uid)&&cbx.presMgr.run()}"lvl"in a&&(a=1*a.lvl,b=cbx.gsUser.get("lvl"),cbx.gsUser.set("lvl",a),classToggle(document.body,"UserAuthed",1<a),classToggle(document.body,"UserIsMod",3==a),classToggle(document.body,"UserIsAdmin",4==a),a!=b&&msgToolsUpdate())}};
cbx.presMgr={state:0,ivalPing:12E4,lastPingTme:0,pingTimes:null,numPings:0,sendPing:function(a){cbx.presMgr.state&&(cbx.$frm.key.value?(a={state:a||"online",vstate:userViewMon&&userViewMon.state,wtop:userViewMon&&userViewMon.props&&userViewMon.props.istop,n:cbx.$frm.nme.value,k:cbx.$frm.key.value,rcid:cbx.arMgr.upstream||"",rcad:cbx.arMgr.adapter||"",clid:cbx.repl.clientID,msid:cbx.repl.masterID||"",num:++cbx.presMgr.numPings},cbx.debug.log("Sending","PRES"),cbx.xhr("users",null,a,function(a,c){cbx.presMgr.state=
c?1:3}),cbx.presMgr.lastPingTme=(new Date).getTime(),cbx.presMgr.pingTimes&&cbx.presMgr.pingTimes.set(cbx.$frm.key.value,cbx.presMgr.lastPingTme)):cbx.debug.log("No key","PRES"))},run:function(){if(cbx.presMgr.state)cbx.presMgr.sendPing(null);else{cbx.presMgr.state=1;var a=function(){var a=(new Date).getTime(),c=cbx.presMgr.lastPingTme;c&&a-c<cbx.presMgr.ivalPing||(cbx.presMgr.pingTimes=cbx.getGSObject(config.id+"-"+config.tid+":pingtimes"),cbx.presMgr.pingTimes.get(cbx.$frm.key.value)>a-cbx.presMgr.ivalPing||
cbx.presMgr.sendPing(null))};window.setTimeout(function(){cbx.presMgr.state=2;cbx.debug.log("Starting passive loop","PRES");a();window.setInterval(a,35E3-Math.round(1E4*Math.random()))},8E3)}},stop:function(){}};
cbx.arMgr={state:0,backoff:1E3,tmr:null,adapter:"",endpoint:"",upstream:null,haveMsgSync:!1,onconnect:null,run:function(){var a=cbx.arMgr.state=1,b=function(){cbx.arMgr.backoff=Math.min(36E4,Math.floor(cbx.arMgr.backoff*(1.5+Math.random())))},c=function(){cbx.arMgr.backoff=Math.floor(1E3*(2+8*Math.random()))},e=function(a){cbx.debug.log(a,"ARMGR")},d=function(b,c){e(cbx.arMgr.state+"->"+b+" "+c);b!=cbx.arMgr.state&&(4>b&&(cbx.arMgr.haveMsgSync=!1),classToggle(document.body,"Connected",4==b),classToggle(document.body,
"Connecting",2==b),classToggle(document.body,"Connwait",0==b),cbx.arMgr.state=a=b)},f=function(a,b){b=b||0;a?e("Timer set for "+b):e("Timer cancelled.");null!==cbx.arMgr.tmr&&(window.clearTimeout(cbx.arMgr.tmr),cbx.arMgr.tmr=null);a&&(cbx.arMgr.tmr=window.setTimeout(function(){e("Timer fired");a()},b))},g=function(a,b){if(cbx.arMgr.upstream!==b&&(d(4,a+" ("+b+") connected. Prev: "+cbx.arMgr.adapter+" ("+cbx.arMgr.upstream+")"),cbx.arMgr.upstream=b,cbx.arMgr.adapter=a,c(),f(null),"function"===typeof cbx.arMgr.onconnect))cbx.arMgr.onconnect(b)},
h=function(){d(2,"Starting LP");cbx.lpconn.onstatechange=function(a){4===a&&g("LP",cbx.lpconn.id+"_"+cbx.lpconn.hash);0===a&&(d(0,"LP bailed out - autorefresh stopped."),statusBar.errorPerm("Lost connection to server. Please reload."))};var a=cbx.isSecureContext?config.lpuri_https:config.lpuri;cbx.arMgr.endpoint=a;cbx.lpStart(a);f(null)},k=[cbx.isSecureContext?config.wsuri_https:config.wsuri],l=config.wsuri_alts,n=cbx.isSecureContext?"wss":"ws";if(l&&l[n])for(var m=0;m<l[n].length;m++)k.push(n+"://"+
l[n][m]);e("Configured WS endpoints: "+k.join(", "));var p=!1,r=0,t=function(){var c=k[r%k.length];d(2,"Attempting WS at "+c);u();b();f(h,3E4+cbx.arMgr.backoff);cbx.wsconn.onstatechange=function(b){if(2===a){-1===b&&(d(0,"WS failed without init."),f(q,0));if(0===b){d(0,"WS failed without subscription.");r++;if(2<r&&!p){e("Too many WS fails; switching to LP");h();return}f(t,cbx.arMgr.backoff)}4===b&&(g("WS",wsconn.id+"_"+wsconn.hash),p=!0,r=0,cbx.lpStop(),cbx.flconn.onmessage=null)}else 4===a&&0===
b&&(d(0,"Lost connection. Retrying in "+cbx.arMgr.backoff),cbx.wsconn.onstatechange=null,f(t,cbx.arMgr.backoff))};cbx.arMgr.endpoint=c;wsStart(c)},q=function(){d(2,"Attempting FL");b();f(h,15E3+cbx.arMgr.backoff);cbx.flconn.onstatechange=function(b){2===a&&0==b?(d(0,"FL failed without connection. "),f(null),h()):2===a&&4===b?g("FL",flconn.id+"_"+flconn.hash):4===a&&0==b&&(d(0,"FL disconnected"),cbx.flconn.onstatechange=null,f(q,cbx.arMgr.backoff))};var c=config.fluri;cbx.arMgr.endpoint=c;startFlashRelay(c)},
u=function(){cbx.repl.onstatechange=null;cbx.repl.onmessage=null;cbx.rpcCommands.upstream=null};(function(){d(1,"Attempting Repl");b();f(t,5E3+cbx.arMgr.backoff);cbx.repl.onstatechange=function(b){2===b?(e("Repl is master (disconnected); falling through"),u(),c(),window.setInterval(function(){cbx.repl.sendmessage("<lpid="+cbx.lp+"\n<upstream="+cbx.arMgr.upstream+"\n")},2E3),t()):1===a&&4===b&&(d(3,"Repl is slave; awaiting upstream..."),f(t,15E3+cbx.arMgr.backoff),cbx.repl.onmessage=function(a){cbx.rpcProcess(a)},
cbx.rpcCommands.upstream=function(a){g("RP",a)})};cbx.repl.start(config.id+"_"+config.tid)})()},stop:function(){}};var lpconn={enabled:!1,state:0,tmeLastRequest:0,curWait:0,lastErr:null,seqErrors:0,numMessages:0,numRequests:0,id:"",hash:"",pool:"",uri:"",onstatechange:null};cbx.lpconn=lpconn;cbx.lpStop=function(){cbx.lpconn.enabled=!1};cbx.lpStart=function(a){var b=cbx.lpconn.enabled;cbx.lpconn.enabled=!0;cbx.lpconn.state=1;cbx.lpconn.uri=a;cbx.lpconn.seqErrors=0;b||cbx.lpLoop()};
cbx.lpLoop=function(){var a=function(a){cbx.debug.log(a,"LP-XHR")},b=function(b,c){if(b!=cbx.lpconn.state&&(a(cbx.lpconn.state+"->"+b+(c?" | "+c:"")),cbx.lpconn.state=b,cbx.lpconn.onstatechange))cbx.lpconn.onstatechange(b)};cbx.lpconn.numRequests++;cbx.lpconn.tmeLastRequest=(new Date).getTime();var c=null;window.XDomainRequest?(c=new XDomainRequest,a("Using XDR")):c=new XMLHttpRequest;var e=!1,d=function(a){cbx.lpconn.curWait=1*Math.min(a,12E4)|0;window.setTimeout(function(){cbx.lpconn.enabled?cbx.lpLoop():
b(0)},cbx.lpconn.curWait)},f=!1,g=function(g){if(!e){e=!0;cbx.lpconn.lastErr=null;var h=(new Date).getTime()-cbx.lpconn.tmeLastRequest;g=Math.max(0,2E3-h)+4E3*Math.random();var k=Math.max(8E3,cbx.lpconn.curWait)*(1.5+Math.random()),m=c.responseText;200<c.status||200>c.status?(cbx.lpconn.lastErr="HTTP "+c.status,a("Got bad HTTP status "+c.status),cbx.lpconn.seqErrors++,2<cbx.lpconn.seqErrors?(cbx.lpconn.enabled=!1,b(0,"Bailing after "+cbx.lpconn.seqErrors+" errors")):d(k)):m?(h=flareUnescape(m)||"",
cbx.rpcProcess(h,function(a,c){cbx.lpconn.seqErrors=0;"hash"==a&&(2<cbx.lpconn.state&&b(2,"Got hash while in state 3/4: returning to 2"),cbx.lpconn.hash=c);"id"==a&&(cbx.lpconn.id=c);"pool"==a&&(cbx.lpconn.pool=c,f=!0,window.setTimeout(function(){f=!1},200));cbx.lpconn.id&&cbx.lpconn.hash&&2<=cbx.lpconn.state&&4>cbx.lpconn.state&&(f?b(4,"Registered"):(b(3,"Registering..."),cbx.xhr("relayreg",{cid:cbx.lpconn.id,chash:cbx.lpconn.hash,m:"lp"})))}),d(g),cbx.lpconn.numMessages++):(cbx.lpconn.lastErr="Empty",
a("Got empty response"),d(5E4<h?g:k))}};c.onload=g;c.onerror=g;c.onreadystatechange=function(){4==c.readyState&&g()};c.timeout=32E4;var h=cbx.lpconn.uri+"/"+cbx.lpconn.id+"_"+cbx.lpconn.hash+config.flrqs;c.open("GET",h);window.setTimeout(function(){c.send();1==cbx.lpconn.state&&b(2)},0);a("GET "+h);return!0};var flconn={id:null,hash:null,pool:null,state:0,numAttempts:0,numCommands:0,numMessages:0,onstatechange:null,onmessage:null};cbx.flconn=flconn;
var startFlashRelay=function(a){var b=null,c=null,e=function(a){if(a!=flconn.state&&(flconn.state=a,flconn.onstatechange))flconn.onstatechange(a)},d=function(a,c){null!=b&&(window.clearTimeout(b),b=null);a&&(b=window.setTimeout(function(){cbx.debug.log("Timer fired","FLAR");a()},c))},f=function(){cbx.debug.log("Failed","FLAR");window.fl_ready=window.fl_gotmsg=window.fl_gotconn=window.fl_pclosed=function(){};flconn.pool=null;flconn.id=null;flconn.hash=null;e(0);d(null)};cbx.flconn.onmessage=function(a){flconn.numMessages++;
4===flconn.state&&d(f,18E4);cbx.rpcProcess(a,function(a,b){flconn.numCommands++;"pool"==a&&(flconn.pool=b);"hash"==a&&(flconn.hash=b);"id"==a&&(flconn.id=b);2>flconn.state||3<flconn.state||!flconn.id||!flconn.hash||(flconn.pool?(cbx.debug.log("Registered","FLAR"),e(4),d(f,18E4)):(cbx.debug.log("Registering","FLAR"),e(3),d(f,1E4),cbx.xhr("relayreg",{cid:flconn.id,chash:flconn.hash,m:"fl"})))})};e(1);window.fl_ready=function(){d(f,1E4);c.doConn()};window.fl_gotconn=function(){e(2);d(f,1E4)};window.fl_pclosed=
function(){cbx.debug.log("Closed","FLAR");f()};window.fl_gotmsg=function(a){if(cbx.flconn.onmessage)cbx.flconn.onmessage(a)};cbx.debug.log("Attempting to load Flash object at "+config.fluri,"FLAR");c=loadSWF("ARswf",a);d(f,1E4)},flareUnescape=function(a){var b={"\\\\":"\\","&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#039;":"'"};return a.replace(/(\\\\)|(&amp;)|(&lt;)|(&gt;)|(&quot;)|(&#039;)/g,function(a){return b[a]})},wsconn={id:null,hash:null,pool:null,state:0,tmeAttempted:0,tmeOpened:0,tmeHalfEst:0,
tmeCompleted:0,numAttempts:0,curAttempts:0,curBackoff:0,numCommands:0,numMessages:0,log:[],onstatechange:null,socket:null,tmr:null,uri:""};cbx.wsconn=wsconn;
var wsStart=function(a){wsconn.uri=a;var b=function(a){cbx.debug.log(a,"WS")},c=function(a){if(a!=wsconn.state&&(wsconn.state=a,wsconn.onstatechange))wsconn.onstatechange(a)},e=function(a,c){null!==wsconn.tmr&&(window.clearTimeout(wsconn.tmr),wsconn.tmr=null);a&&(wsconn.tmr=window.setTimeout(function(){b("Timer fired");a()},c))};try{wsconn.tmeAttempted=(new Date).getTime();wsconn.numAttempts++;wsconn.curAttempts++;var d=function(){e(null);wsconn.id=null;wsconn.hash=null;wsconn.pool=null;0<wsconn.state&&
(f.close(),f=null,c(0))};wsconn.socket&&(wsconn.socket.onclose=function(){},wsconn.socket.onerror=function(){},wsconn.socket.close(),wsconn.socket=null);b("OPENING");c(1);e(d,1E4);try{wsconn.socket=new WebSocket(a+config.flrqs)}catch(g){return b("Caught exception on init: "+g.message),e(null),c(-1),!1}var f=wsconn.socket;wsconn.close=function(){b("Closed by call");d()};f.onopen=function(){c(2);b("OPEN");e(d,5E3);wsconn.tmeOpened=(new Date).getTime();wsconn.curAttempts=0};f.onclose=function(a){b("CLOSE "+
(a.wasClean?"CLEAN":"UNEXPECTED")+" ("+a.code+") "+a.reason);d()};f.onerror=function(a){b("ERROR");d()};f.onmessage=function(a){wsconn.numMessages++;4===wsconn.state&&e(d,18E4);a=flareUnescape(a.data);cbx.rpcProcess(a,function(a,f){wsconn.numCommands++;"pool"==a&&(wsconn.pool=f);"hash"==a&&(wsconn.hash=f);"id"==a&&(wsconn.id=f);2>wsconn.state||3<wsconn.state||!wsconn.id||!wsconn.hash||(wsconn.pool?(b("Got subscription."),c(4),e(d,18E4),wsconn.tmeCompleted=(new Date).getTime()):(b("Subscribing..."),
c(3),e(d,1E4+5E3*Math.random()),wsconn.tmeHalfEst=(new Date).getTime(),cbx.xhr("relayreg",{cid:wsconn.id,chash:wsconn.hash,m:"ws"})))})}}catch(g){return b("Caught exception: "+g.message),e(null),c(0),!1}},rand=function(a,b){a=Math.ceil(a);b=Math.floor(b);return Math.floor(Math.random()*(b-a+1))+a},initOnliners=function(){var a=function(a){cbx.debug.log(a,"ONLRS")},b=overlay.create("Online users","Users"),c=document.getElementById("users"),e=0,d="",f=function(a){var b=cbx.gsUser.get("lvl"),c=cbx.gsUser.get("uid"),
d=a.querySelectorAll("img.pic");for(a=0;a<d.length;a++)(function(a){a.onclick=function(){showFullImage(a.src)}})(d[a]);d=l().getElementsByClassName("usr");for(a=0;a<d.length;a++){var e=d[a],f=[];(function(a,d){config.pm&&0<a.id&&c&&a.id!=c&&(2<b||2<a.lvl)&&f.push({cN:"Envelope",text:lang[15],call:function(){cbx.setInputMode("//pm "+a.id);msgTools.close();return!1}});2<b&&a.id!=c&&b>a.lvl&&4>a.lvl&&(f.push({cN:"Kick",text:"Kick user",call:function(){cbx.cmdExec("//kick "+a.id);msgTools.close();return!1}}),
f.push({cN:"Ban",text:lang[18],call:function(b){cbx.ban(a.id,b.element());msgTools.close();return!1}}));var e=d.getElementsByClassName("msgtools");e.length&&d.removeChild(e[0]);f.length&&(e=msgTools.create(f),d.insertBefore(e,d.firstChild))})(k(e),e)}},g=null,h=function(){null!==g&&(window.clearTimeout(g),g=null);for(var a=l().getElementsByClassName("usr"),b=0;b<a.length;b++){var c=a[b],d=k(c);c=c.getElementsByClassName("dtxt")[0];d.updtme&&c&&(c.innerHTML=relTime(d.updtme).str)}g=window.setTimeout(h,
3E4)},k=function(a){return a?{id:a.getAttribute("data-id"),lvl:a.getAttribute("data-lvl"),nme:a.getElementsByClassName("nme")[0].textContent,pres:a.getAttribute("data-pres"),updtme:a.getAttribute("data-pres-time")}:{}},l=function(){return b.isVisible?b.body:c},n=null,m=0,p=function(){"LOADING"!=d&&(n&&(window.clearTimeout(n),n=null),d="LOADING",e=(new Date).getTime(),cbx.xhr("onliners",{xhr:1},null,function(b,c){if(c){if(3<m){a("Init failed and retries exhausted.");d="FAILED";return}a("Init failed. Retry after delay...");
d="FAIL_RETRY";n=window.setTimeout(p,++m*rand(2,5)*1E3)}m=0;d="LOADED";c=l();c.innerHTML=b;f(c);v(null,null);h()}))},r=null,t=function(b){if("LOADED"===d){for(var c=l(),e=c.getElementsByClassName("usr"),f=!1,g=0;g<e.length;g++)e[g]&&e[g].getAttribute("data-id")==b&&(classToggle(e[g],"Left",!0),f=!0);null!==r&&window.clearTimeout(r);r=window.setTimeout(function(){for(var a=c.querySelectorAll(".usr.Left"),b=0;b<a.length;b++)a[b].parentNode.removeChild(a[b])},2E3);a("Removing user "+b+": "+f);f&&v(null,
null)}},q=null,u=null,v=function(a,b){if("LOADED"===d){var c=l(),e=c.getElementsByClassName("usr");c=c.querySelector(".notUsr > span");u=e.length;"anon"===b&&(q=a);c&&("anon"!==b&&(q=1*c.innerHTML),c.innerHTML=q)}else"total"===b&&(u=a,q=0);a=u+q;cbx.onlinerBtn.text(a);cbx.notifyParent("onliners",a)};cbx.onlinerBtn=makeButton("Users","0","Users online",function(){c&&c.clientWidth||b.isVisible?(overlay.switchTo(),classToggle(document.body,"WithUserPanel",!1)):(classToggle(document.body,"WithUserPanel",
!0),p(),c&&c.clientWidth||(classToggle(document.body,"WithUserPanel",!1),overlay.switchTo(b)))},"btnOnliners");v(1*config.onu,"total");cbx.onlinerBtn.enable();cbx.rpcCommands.ujoin=function(b){if("LOADED"===d){var c=l(),e=c.children,g=document.createElement("div");g.innerHTML=b;var h=g.getElementsByClassName("usr")[0];b=k(h);t(b.id);a("Adding user "+b.id);for(g=0;g<e.length&&-1!=e[g].className.indexOf("usr");g++){var m=e[g].getAttribute("data-lvl");if(m<b.lvl)break;if(m==b.lvl&&e[g].getElementsByClassName("nme")[0].textContent.toLowerCase()>
b.nme.toLowerCase())break}classToggle(h,"Joined",!0);c.insertBefore(h,e[g]);window.setTimeout(function(){classToggle(h,"Joined",!1)},0);v(null,null);f(c)}};cbx.rpcCommands.uleave=t;cbx.rpcCommands.updusrcnt=function(a){v(1*a,"total")};cbx.rpcCommands.uanoncnt=function(a){v(1*a,"anon")};cbx.rpcCommands.upres=function(a){if("LOADED"===d){var b=a.split("\t");a=b[0];b=b[1];for(var c=l(),e=c.getElementsByClassName("usr"),g=0;g<e.length;g++)if(e[g]&&e[g].getAttribute("data-id")==a){e[g].setAttribute("data-pres",
b);e[g].setAttribute("data-pres-time",cbx.unixTime());break}f(c)}};var w=cbx.arMgr.onconnect;cbx.arMgr.onconnect=function(){w();"LOADED"===d&&1E4<(new Date).getTime()-e&&p()};classState(document.body,"WithUserPanel")&&window.setTimeout(function(){p()},10)},Tooltip=function(){var a=null,b=function(){if(a)return a;a=document.createElement("div");a.id="tooltip";document.body.appendChild(a);return a},c=!1,e=function(a,c){var d=b();d.style.top="0px";d.style.left="0px";d.textContent=a;classToggle(d,"Visible",
!0);a=c.getBoundingClientRect();var e=d.getBoundingClientRect();c=e.right-e.left;var f=document.documentElement.clientWidth,g=a.left;e=a.top-(e.bottom-e.top);g+c>f&&(g=f-c-2);0>e&&(e=a.bottom);d.style.top=e+"px";d.style.left=g+"px"},d=function(){var a=b();classToggle(a,"Visible",!1)},f=null,g=function(){this.tooltip&&(f&&(window.clearTimeout(f),f=null),d(),f=window.setTimeout(function(){c=!1},500))},h=function(){var a=this.tooltip,b=this.tooltipRef;a&&(f&&(window.clearTimeout(f),f=null),c?e(a,b):
f=window.setTimeout(function(){c=!0;e(a,b)},500))};return function(a,b,c){!a.tooltip&&b&&(a.addEventListener("mouseenter",h),a.addEventListener("focus",h),a.addEventListener("mouseleave",g),a.addEventListener("mouseup",g),a.addEventListener("blur",g));a.tooltip=b;a.tooltipRef=c}}(),makeCtxmenu=function(){var a=null,b=function(){if(a)return a;a=document.createElement("div");a.id="menu";document.body.appendChild(a);return a},c=!1,e=function(){var a=b();classToggle(a,"Visible",!1);c=!1};document.documentElement.addEventListener("mousedown",
function(b){if(c){b=b.target;do if(b===a)return;while(b=b.parentElement);e()}},{passive:!0});var d=null;return function(){var a=document.createDocumentFragment(),g={frag:a,add:function(b){a.appendChild(b);return g},show:function(a){var e=b();if(d)for(;0<e.childNodes.length;)d.frag.appendChild(e.childNodes[0]);e.innerHTML="";e.appendChild(g.frag);e=b();e.style.top="0px";e.style.left="0px";classToggle(e,"Visible",!0);a=a.getBoundingClientRect();var f=e.getBoundingClientRect(),h=f.right-f.left,m=document.documentElement.clientWidth,
p=a.left;f=a.top-(f.bottom-f.top);p+h>m&&(p=m-h);0>f&&(f=a.bottom);e.style.top=f+"px";e.style.left=p+"px";c=!0;return d=g},hide:e};return g}}(),Emotes=function(){var a=[],b=null;return{enqueueAll:function(b){b=b.querySelectorAll(".imgBox.Defer");for(var c=0;c<b.length;c++)b[c].getAttribute("data-state")||(a.push(b[c]),b[c].setAttribute("data-state","queued"))},load:function(){null!==b&&(window.clearTimeout(b),b=null);b=window.setTimeout(function(){for(var b=0;b<a.length;b++){var e=a[b];if(e&&"queued"===
e.getAttribute("data-state")){var d=e.getBoundingClientRect();!d||!d.height&&!d.width||!document.documentElement.clientHeight||d.top>=document.documentElement.clientHeight||0>d.bottom||(d=new Image,d.src=e.getAttribute("data-url"),e.setAttribute("data-state","loading"),e.appendChild(d),e.getAttribute("data-alt")&&(d.alt=e.getAttribute("data-alt")),e.getAttribute("data-tooltip")&&Tooltip(d,e.getAttribute("data-tooltip"),d),a.splice(b--,1))}else a.splice(b--,1)}},400)}}}(),scrollFollow=!0,scrollHeightPrev=
null,keepScrollTmr=null,keepScrollCnt=0,loadingOlderMsgs=null,historyLoadCount=0,noMoreOlder=!1,isPaused=!1,sTprev=0,tmrScrollFuncGate=null,onScrollFunc=function(a){var b=document.getElementById("messages"),c=b.clientHeight||Infinity,e=b.scrollTop||0;b=b.scrollHeight;c=config.bs&&e+c>b-10||!config.bs&&10>e;!scrollFollow&&c||!0===a?(cbx.debug.log("Scroll locked ",a),scrollFollow=!0):(scrollFollow&&!c&&!1!==a&&(scrollFollow=!1,cbx.refreshBtn.icon(config.bs?"DoubleDown":"DoubleUp").onclick(function(){cbx.autoScroll(!0);
return!1}).enable()),Emotes.load())};
cbx.autoScroll=function(a){var b=document.getElementById("messages");b?(a=a||!1,window.setTimeout(function(){null!==keepScrollTmr&&(window.clearTimeout(keepScrollTmr),keepScrollTmr=null);"addEventListener"in b?b.removeEventListener("scroll",onScrollFunc,{passive:!0}):b.onscroll=null;a&&(scrollFollow=!0);scrollFollow&&!isPaused&&cbx.refreshBtn.icon("Circle").disable();cbx.rsz(!1);window.onresize=cbx.rsz;var c=Math.max(document.body&&document.body.scrollHeight,b&&b.scrollHeight,document.documentElement&&
document.documentElement.scrollHeight);scrollFollow?b.scrollTop=config.bs?c:0:!config.bs&&scrollHeightPrev&&c-scrollHeightPrev&&(b.scrollTop+=c-scrollHeightPrev);c!==scrollHeightPrev&&cbx.notifyParent("heightchange",c);scrollHeightPrev=c;null!==tmrScrollFuncGate&&(window.clearTimeout(tmrScrollFuncGate),tmrScrollFuncGate=null);tmrScrollFuncGate=window.setTimeout(function(){"addEventListener"in b?b.addEventListener("scroll",onScrollFunc,{passive:!0}):b.onscroll=onScrollFunc;onScrollFunc(a)},100);keepScrollTmr=
window.setTimeout(cbx.autoScroll,500);if(unreadMessages[0]){c=document.getElementById("messages").getBoundingClientRect();do{var e=unreadMessages[0].getBoundingClientRect();if(!e||!e.top&&!e.bottom)break;if(config.bs&&e.bottom>c.bottom)break;if(!config.bs&&e.top<c.top)break;unreadMessages.shift().classList.remove("Unread")}while(unreadMessages[0])}c=unreadMessages.length||0;c+=droppedMessages;cbx.refreshBtn.text(c||"");c=document.documentElement.clientHeight;if(cbx.$older&&c){var d=function(){var a=
document.getElementById("messages").getBoundingClientRect(),b=cbx.$older.getBoundingClientRect(),c=Math.max(.25*a.height,50);return config.bs&&b.top>a.top-c||!config.bs&&b.bottom<a.bottom+c};!d()||loadingOlderMsgs||noMoreOlder||null===loadingOlderMsgs&&(loadingOlderMsgs=window.setTimeout(function(){d()?(historyLoadCount++,cbx.$older.innerHTML="Loading...",cbx.xhr("archive",{xhr:1,i:messages.getOldestID(),c:historyLoadCount},null,function(a,c){loadingOlderMsgs=null;if(c||!a)cbx.$older.innerHTML="No more messages",
noMoreOlder=!0;else{c=b.scrollHeight;var d=b.scrollTop;cbx.$older.insertAdjacentHTML(config.bs?"afterend":"beforebegin",a);cbx.$older.innerHTML="&nbsp;";config.bs&&(b.scrollTop=d+(b.scrollHeight-c));scrollHeightPrev=b.scrollHeight;msgToolsUpdate();cbx.upd_tms()}})):loadingOlderMsgs=null},historyLoadCount?1200:250))}scrollFollow&&!loadingOlderMsgs&&b.clientHeight&&b.scrollHeight>10*b.clientHeight&&(messages.trimTail(Math.floor(.8*messages.getCount())),noMoreOlder=!1);!scrollFollow&&!loadingOlderMsgs&&
500<messages.getCount()&&(cbx.refreshBtn.icon("CirclePlay").onclick(function(){isPaused=!1;droppedMessages=0;do_refresh(!0);return!1}).enable(),isPaused=!0)},10)):cbx.debug.log("No messages container","SCROLL")};
cbx.rsz=function(a){a=cbx.$frm;var b=document.documentElement.clientWidth,c=document.documentElement.clientHeight;if(c&&b){cbx.rszH=c;cbx.rszW=b;var e=a.clientHeight;a=function(a,b){a.style.overflow="auto";a.scrollHeight<=c-e?a.style[b]="auto":(a.style[b]="0px",a.scrollHeight<=c-e&&(a.style.overflow="hidden",a.style[b]="auto"))};b=document.getElementById("overlay");var d=document.getElementById("messages"),f=document.getElementById("users"),g=document.getElementById("typingStatus");overlay.setFull(b.scrollHeight>=
c-e);config.ft?(d.style.top=f.style.top=b.style.top=g.style.top=e+"px",a(d,"bottom"),a(b,"bottom"),a(f,"bottom")):(d.style.bottom=f.style.bottom=b.style.bottom=g.style.bottom=e+"px",a(d,"top"),a(b,"top"),a(f,"top"))}else cbx.debug.log("Bailed on dims "+b+"x"+c,"RSZ")};
var pop=function(a,b,c,e,d){cbx.debug.log("Opening pop "+a+" at "+b+" x "+c,"POP");var f=window.open(a,"cb"+config.id+a,"width="+b+",height="+c+",toolbar=no,scrollbars="+e+",status=no,resizable=yes");window.setTimeout(function(){var a=screen.width,d=screen.height,e=screen.availLeft||0,l=screen.availTop||0;f.focus();window.setTimeout(function(){f.moveTo(e+a/2-b/2-100,l+d/2-c/2)},50)},10);d&&(window.openerCallback=d);return f};function esc(a){return encodeURIComponent(a)}
cbx.unixTime=function(){var a=cbx.gsPrefs.get("timeDelta")||0;return Math.round((new Date).getTime()/1E3)+a};
cbx.xhr=function(a,b,c,e){var d=null,f=null;e=e||function(){};var g=function(a){var b=[],c;for(c in a)b.push(c+"="+esc(a[c]));return b.join("&")},h=function(a){a=a||lang[14]+"E-Unknown";window.clearTimeout(f);null!==d&&(d.onreadystatechange=function(){},d.abort(),d=null);e("",a)},k=["./?sec="+a,config.rq,"_v="+cbx.ver],l=g(b);l&&k.push(l);k=k.join("&");if(window.XMLHttpRequest)d=new XMLHttpRequest;else if(window.ActiveXObject)try{d=new ActiveXObject("Msxml2.XMLHTTP")}catch(m){try{d=new ActiveXObject("Microsoft.XMLHTTP")}catch(p){}}d||
h(lang[14]+"L-JS");var n="-";d.onreadystatechange=function(){if(4==d.readyState){n=d.status;window.clearTimeout(f);var a=" ("+n+")";if(0==d.status)return h(lang[14]+"L-network"+a);if(200!=d.status)return h(lang[14]+"R-server"+a);var b=d.responseText,c=b.substring(0,1);b=b.substring(1);if("1"!=c&&"0"!=c)return h(lang[14]+"R-chksum"+a);if("0"==c)return h(""+b);e(b,null)}};d.onerror=function(a){h("Internet connection failure.")};f=window.setTimeout(function(){h("L-timeout")},2E4);l=c?"POST":"GET";d.open(l,
k,!0);d.setRequestHeader("Accept","*/*");d.responseType="text";c?(d.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),d.send(g(c))):d.send();try{cbx.debug.log(l+" "+a+" "+JSON.stringify(b)+" "+JSON.stringify(c),"XHR")}catch(m){cbx.debug.log(l+" "+a+" [Error logging data]","XHR")}};
var statusBar=function(){var a=null,b=null,c=null,e=function(){var a=document.getElementById("barNotice"),b=document.getElementById("barDefault"),c=document.getElementById("barTitle");a.className="bar Hide";overlay.getCurrent()?c.className="bar":b.className="bar"},d=function(d,g,h){var f=document.getElementById("barNotice"),l=document.getElementById("barDefault"),n=document.getElementById("barTitle");cbx.debug.log(d?d:"(Hide)","STATUS");null!==a&&(window.clearTimeout(a),a=null);null!==b&&window.clearInterval(b);
c||(c=makeButton("Cancel Right","","",function(){e()},"btnStatus").enable());if(d){c.text(d);f.className="bar "+(g?g:"Warn");l.className="bar Hide";n.className="bar Hide";var m=document.querySelector("#btnStatus span"),p=0;m.offsetWidth>f.clientWidth-60&&(b=window.setTimeout(function(){var a=function(){32==d.charCodeAt(p)&&p++;c.text(d.substring(p));p+=1;m.offsetWidth>f.clientWidth-60?b=window.setTimeout(a,90):(p=0,b=window.setTimeout(function(){c.text(d);b=window.setTimeout(a,1E3)},1E3))};a()},1E3));
cbx.autoScroll(!1);h||(a=window.setTimeout(e,Math.max(3E3,d.length/8*1E3)))}else e()};return{error:function(a){d(a,"Error",!1)},warn:function(a){d(a,"Warn",!1)},set:function(a){d(a,"Okay",!1)},errorPerm:function(a){d(a,"Error",!0)},hide:e}}(),setTypingStatus=function(){var a=null;return function(b){var c=document.getElementById("typingStatus");c.innerHTML=b?b:"";null!==a&&(window.clearTimeout(a),a=null);b?(c.className="Show",a=window.setTimeout(function(){c.className="SlowHide"},5E3)):c.className=
""}}();cbx.parseMsg=function(a){if(a=msgFromTSF(a)){var b=insertMessage(a);b&&(parseMsgTags(b),a.isUpdate||(cbx.notifyParent("message",null),cbx.newMessageAsync()))}};
var parseMsgTags=function(a){if(a.getElementsByClassName){var b=a.getElementsByClassName("atname");a=a.getElementsByClassName("bbUser");if(b||a){var c="";cbx.$frm.nme.value&&(c=cbx.$frm.nme.value.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"));for(var e=new RegExp("^@?"+c+"$"),d=0;d<b.length;d++){var f=b[d];if(!c)break;if(f&&f.textContent&&f.textContent.match(e)){audioPlay("volTag");break}}for(d=0;d<a.length;d++)if(f=a[d],f.getAttribute&&cbx.gsUser.get("uid")&&f.getAttribute("data-uid")==cbx.gsUser.get("uid")){audioPlay("volTag");
break}}}};cbx.newMessageTmr=null;cbx.newMessageAgain=!1;cbx.newMessageAsync=function(){if(cbx.newMessageTmr)return cbx.newMessageAgain=!0,!1;audioPlay("volAll");titleflash();cbx.newMessageTmr=window.setTimeout(function(){cbx.newMessageTmr=null;cbx.newMessageAgain&&(cbx.newMessageAgain=!1,cbx.newMessageAsync())},1E3)};
var add_priv_post=function(a,b){a={id:"P"+(1E4*Math.random()|0),unixtime:cbx.unixTime(),datestr:"",namehtml:a,usrlvl:0,exturl:"",msghtml:b,bad_flags:32,isServer:!0};insertMessage(a);cbx.upd_tms()},msgFromTSF=function(a){a=a.split("\t");if(!a||7>a.length)return cbx.debug.log("Badly formed; ignoring","MSGTSF"),null;a={id:a[0],unixtime:a[1],datestr:a[2],namehtml:a[3],usrlvl:a[4],exturl:a[5],msghtml:a[6],imgurl:a[7],bad_flags:a[8],uid:a[9],flaghtml:a[10],localID:a[11]};a.isRedirected=!!(a.bad_flags&16);
a.isPrivate=!!(a.bad_flags&32);a.isSticky=-1==a.id;a.isTemp=0==a.id;return a},messages={getCount:function(){return document.querySelectorAll("#messages > .msg").length},getById:function(a){return document.querySelector('#messages > .msg[data-id="'+a+'"]')},getAll:function(){return document.querySelectorAll("#messages > .msg")},getData:function(a){if(a){var b={};b.uid=a.getAttribute("data-uid");b.usrlvl=a.getAttribute("data-lvl");b.id=a.getAttribute("data-id");b.unixtime=1*a.getAttribute("data-time");
b.isRedirected=!!a.getAttribute("data-redirected");return b}},getOldestID:function(){var a=document.querySelectorAll("#messages > .msg");if(!a.length)return null;for(var b=Infinity,c=0;c<a.length;c++){var e=messages.getData(a[c]);e&&e.id&&1*e.id&&(b=Math.min(b,1*e.id))}return Math.max(b,0)},insertAtHead:function(a,b){var c=document.getElementById("msgHead");config.bs&&!b||!config.bs&&b?c.parentElement.insertBefore(a,c):c.parentElement.insertBefore(a,c.nextSibling)},trimTail:function(a){var b=messages.getAll(),
c=function(a){b[a]&&(unreadMessages[0]===b[a]&&unreadMessages.shift(),b[a].parentElement.removeChild(b[a]))};if(config.bs){a=b.length-a;for(var e=0;e<a;e++)c(e)}else for(e=b.length-1;e>=a;e--)c(e)},setBookmark:function(){cbx.$markobj||(cbx.$markobj=document.createElement("div"),cbx.$markobj.className="notMsg Marker");messages.insertAtHead(cbx.$markobj);messages.numSinceBookmark=0},numSinceBookmark:0},unreadMessages=[],droppedMessages=0,insertMessage=function(a){var b=function(a){cbx.debug.log(a,"MSG")};
a.id>cbx.lp&&1*a.id&&!isPaused&&(cbx.lp=a.id);var c=function(a){var b=[];if(a.isTemp||a.isSticky)return b.push('<div align="center">'+a.msghtml+"</div>"),b.join("");config.av&&(a.imgurl?b.push('<img src="'+a.imgurl+'" class="pic">'):b.push('<span class="pic Empty"></span>'));config.sf&&b.push(a.flaghtml);a.isPrivate&&b.push('<div class="status" title="'+lang[15]+'"></div>');a.isRedirected&&b.push('<div class="status" title="'+lang[26]+'"></div>');a.isPinned&&b.push('<div class="status" title="Pinned"></div>');
1<config.dt&&b.push('<div class="dtxt" id="t'+a.unixtime+'" '+(config.rt?'dir="ltr"':"")+">"+a.datestr+"</div>");b.push("<div");1==config.dt&&b.push(' title="'+a.datestr+'"');b.push(' class="nme"');config.rt&&b.push(' dir="ltr"');b.push(">"+a.namehtml+"</div>");config.ae&&a.exturl&&b.push('<a href="'+a.exturl+'" rel="noreferrer" target="_blank" class="nmeurl"></a>');b.push('<div class="body">'+a.msghtml+"</div>");return b.join("")},e=!1,d=messages.getById(a.id);d&&(e=!0,b("Got update for message "+
a.id));a.localID&&(d=messages.getById("L"+a.localID))&&(e=!0,b("Got update for local message "+a.localID));var f=cbx.gsUser.get("ignores")||[];if(f.indexOf&&(-1<f.indexOf(a.uid)||-1<f.indexOf(a.namehtml)))return b("User in ignore list; ignoring"),!1;if(a.msghtml||e){f=["msg"];a.isSticky&&f.push("Sticky");a.isTemp&&f.push("Temp");a.isPrivate&&f.push("Private");a.isServer&&f.push("Server");a.isRedirected&&f.push("Redirected");a.isPinned&&f.push("Pinned");a.isLocal&&f.push("Sending");switch(a.usrlvl){case "2":f.push("Reg");
break;case "3":f.push("Mod");break;case "4":f.push("Adm");break;case "5":f.push("Bot")}d||(d=document.createElement("div"));e&&(a.isUpdate=!0);if(!e&&isPaused)droppedMessages++,b("Paused; dropped");else{e||messages.numSinceBookmark++;scrollFollow||e||(f.push("Unread"),unreadMessages.push(d));if(a.msghtml||!e)d.innerHTML=c(a);d.className=f.join(" ");d.setAttribute("data-id",a.id);d.setAttribute("data-time",a.unixtime);d.setAttribute("data-uid",a.uid||0);d.setAttribute("data-lvl",a.usrlvl||0);a.isRedirected&&
d.setAttribute("data-redirected","true");if(e)b("Updated message "+a.id),a.isPinned&&messages.insertAtHead(d,!0);else{if(c=document.getElementById("msgWelcome"))c.style.display="none";a.isPinned?messages.insertAtHead(d,!0):messages.insertAtHead(d);b("Inserted message "+a.id);cbx.autoScroll(!1)}return d}}else b("Empty message; ignoring")},relTime=function(a){var b=cbx.unixTime(),c=lang[16],e=[2592E3,604800,86400,3600,60,1];b=a=b-a;0>b&&(b=0);60>b&&(b=5*Math.ceil(b/5));for(var d=0;6>d;d++){var f=0;
if(1<b/e[d]){b/=e[d];f=10-2*d;break}}b=Math.round(b);return{str:5>a?"&nbsp;":lang[24].replace("%d",b).replace("%s",c[1==b?f:f+1]),secs:a}},updTmsTmr=null;
cbx.upd_tms=function(){if(3!=config.dt)return!0;null!==updTmsTmr&&window.clearTimeout(updTmsTmr);for(var a=messages.getAll(),b=60,c=0;c<a.length;c++){var e=messages.getData(a[c]);if(e.unixtime){var d=a[c].querySelector(".dtxt");d&&(e=relTime(e.unixtime),b=Math.min(e.secs,b),d.title||(d.title=d.innerHTML),d.innerHTML=e.str)}}updTmsTmr=window.setTimeout(cbx.upd_tms,1E3*Math.max(7,b))};
cbx.colorPicker=function(){var a=null,b="262626 c00000 e16900 e1c700 669f00 00a198 004c92 5f03bb 9c026e 444444 DE1A10 FF870F FFE500 84BD00 00BFB6 006AB0 7D21D9 BA208C 808080 ff564c ffc34b ffff3c c0f93c 3cfbf2 3ca6ec b95dff f65cc8".split(" "),c=function(){if(a)return a;a=overlay.create("Colour picker","colorPicker");for(var c=['<table border="0" cellpadding="0" cellspacing="0" width="100%" style="cursor:pointer">'],f=0,g=1;f<b.length;f++)0===f%9&&(c[g++]="<tr>"),c[g++]='<td style="height: 2em; width: '+
100/9+"%; background-color: #"+b[f]+';">&nbsp;</td>',8===f%9&&(c[g++]="</tr>");c[g++]="</table>";a.body.innerHTML=c.join("");a.body.onclick=function(a){a.target&&"TD"==a.target.tagName&&(cbx.setInputMode("^#"+b[9*a.target.parentElement.rowIndex+a.target.cellIndex]),e())};return a},e=function(){var a=c();a&&overlay.switchTo(a.isVisible?null:a)};return{toggle:e}}();
var insertAtCaret=function(a,b){var c=document,e=c.forms[0].pst,d;e.value==lang[3]&&(e.value="");if(c.selection){var f=c.selection.createRange();null!=f.text&&(f.text="\u0001");var g=d=e.value.indexOf("\u0001");-1==g&&(g=d=e.value.length);f.moveStart("character",-1);f.text=""}else"null"!=e.selectionStart&&(d=e.selectionStart,g=e.selectionEnd);var h=" "==e.value.charAt(g)?!0:!1;a=(b||0==d||" "==e.value.charAt(d-1)?"":" ")+a;a+=b||h?"":" ";e.value=e.value.substring(0,d)+a+e.value.substring(g);a=d+a.length+
(h?1:0);c.selection?(f.moveEnd("character",-e.value.length),f.moveEnd("character",a),f.moveStart("character",a),f.select()):"null"!=e.selectionStart&&(e.selectionStart=a,e.selectionEnd=a);e.focus()};cbx.msgModeStr="";
cbx.setInputMode=function(a){var b=cbx.$frm;"undefined"===typeof a&&(a="",b.pst.value.substring(0,cbx.msgModeStr.length)==cbx.msgModeStr&&(a=cbx.msgModeStr),b.pst.value="");if(b.pst.value.substring(0,a.length)!==a){var c=b.pst.value.substring(cbx.msgModeStr.length+(cbx.msgModeStr?1:0));b.pst.value=(a?a+" ":"")+c;cbx.msgModeStr=a}b.pst.focus();a=b.pst;"number"==typeof a.selectionStart?a.selectionStart=a.selectionEnd=a.value.length:"undefined"!=typeof a.createTextRange&&(a.focus(),a=a.createTextRange(),
a.collapse(!1),a.select())};
var makeButton=function(){return function(a,b,c,e,d,f){var g=null,h="",k="",l={disable:function(){h="disabled";g.className=k+" Disabled";return l},enable:function(){h="interactive";g.className=k+" Interactive";g.style.display="";return l},hide:function(){h="hidden";g.style.display="none";return l},text:function(a){m.textContent=a;return l},onclick:function(a){g.onclick=function(b){if("interactive"!=h)return!1;if("function"===typeof a)return a(l,b),b.stopPropagation(),b.preventDefault=!0,!1};return l},
icon:function(a){n.className="ico "+a;return l},tip:function(a){g.alt=a||"";Tooltip(g,a,g);return l},element:function(){return g},addClass:function(a){k+=" "+a;g.className=k;return l},classToggle:function(a,b){classToggle(g,a,b);return l},ref:f};d&&(g=document.getElementById(d));g||(d&&cbx.debug.log("Elem "+d+" not found; creating.","BTN"),g=document.createElement("button"),g.type="button",d&&(g.id=d));g.innerHTML="";k=g.className;h="disabled";var n=document.createElement("i");l.icon(a);var m=document.createElement("span");
l.text(b);g.appendChild(n);g.appendChild(m);l.tip(c);l.onclick(e);return l}}(),msgTools=function(){var a=null,b=null,c=null,e=function(){a.className="msgtools";c.icon("EllipsisV");c.tip("");b=a;c=a=null;document.body.onmousedown=null};return{create:function(d){var f=document.createElement("div");f.className="msgtools";var g=document.createElement("div");g.className="btntray";for(var h=d.length-1;0<=h;h--){var k=makeButton(d[h].cN,"",d[h].text,d[h].call).enable();g.appendChild(k.element());d[h].btn=
k}f.appendChild(g);f.appendChild(makeButton("EllipsisV","","",function(h){scrollFollow=!1;b=null;null!==a&&e();if(f!==b){f.className="msgtools Open";a=f;c=h;for(var k=d.length-1;0<=k;k--)d[k].onfirstshow&&(d[k].onfirstshow(d[k].btn),d[k].onfirstshow=null);h=h.element().getBoundingClientRect();g.style.right=h.right-h.left+"px";document.body.onmousedown=function(a){a=a.target;do if(a===g||a===f)return;while(a=a.parentElement);e()}}}).enable().element());return f},close:e}}(),imgOverlay=overlay.create("Image",
"Image"),showFullImage=function(a){a&&(a=a.replace(/cbox.im\/i\/([a-z0-9]+?)\.(.+?)\.([a-z0-9]{1,5})/i,"cbox.im/i/$1.$3"),overlay.switchTo(imgOverlay),imgOverlay.body.innerHTML='<img src="'+a+'">',imgOverlay.body.onclick=function(){overlay.switchTo()})},ivalModChanCount=null,modBtnCountUpdate=function(){cbx.xhr("modchaninfo",{n:cbx.$frm.nme.value,k:cbx.$frm.key.value},null,function(a,b){a&&!b&&(a=JSON.parse(a),cbx.modBtn.text(1*a.num_messages))})},lnkd=[],msgToolsUpdate=function(){var a=!1,b=cbx.gsUser.get("lvl"),
c=cbx.gsUser.get("lpid"),e=cbx.gsUser.get("uid");2<b&&(a=!0);a&&config.modtid&&config.tid!=config.modtid?(cbx.modBtn.enable(),null===ivalModChanCount&&(modBtnCountUpdate(),ivalModChanCount=window.setInterval(modBtnCountUpdate,3E4))):(cbx.modBtn.hide(),null!==ivalModChanCount&&(window.clearInterval(ivalModChanCount),ivalModChanCount=null));for(var d=messages.getAll(),f=0;f<d.length;f++){var g=d[f],h=[];(function(d,f){var g=d.id;Emotes.enqueueAll(f);var k=f.querySelector("img.pic");k&&!k.onclick&&(k.onclick=
function(){showFullImage(k.src)});config.pm&&0<d.uid&&e&&d.uid!==e&&(a||2<d.usrlvl)&&h.push({cN:"Envelope",text:lang[15],call:function(){cbx.setInputMode("//pm "+d.uid);msgTools.close();return!1}});(a||config.ld&&!d.isRedirected&&g==c&&g==cbx.lp&&1<b)&&0<g&&h.push({cN:"Trash",text:lang[17],call:function(){cbx.del(g);f.className+=" Deleting";msgTools.close();return!1}});a&&0<g&&d.uid!=e&&b>d.usrlvl&&4>d.usrlvl&&h.push({cN:"Ban",text:lang[18],call:function(a){cbx.ban(g,a.element());msgTools.close();
return!1},onfirstshow:function(a){cbx.xhr("getip",{n:cbx.$frm.nme.value,k:cbx.$frm.key.value,i:d.id},null,function(b,c){if(!b||c)return!1;a.tip(lang[18]+" (IP: "+b+")")})}});config.modtid&&a&&d.usrlvl<b&&1<d.usrlvl&&h.push({cN:"VoiceOn",text:"Toggle voice",call:function(){msgTools.close();var a=cbx.$frm;cbx.xhr("delban",{n:a.nme.value,k:a.key.value,voicetoggle:g},null,function(a,b){b?statusBar.warn(b):statusBar.set(a)});return!1}});config.modtid&&a&&d.isRedirected&&h.push({cN:"Accept",text:"Accept and publish",
call:function(){msgTools.close();var a=cbx.$frm;cbx.xhr("delban",{n:a.nme.value,k:a.key.value,repost:g},null,function(a,b){b?statusBar.warn(b):cbx.del_proc(g,g)});return!1}});lnkd[g]&&lnkd[g].parentElement&&(lnkd[g].parentElement.removeChild(lnkd[g]),delete lnkd[g]);if(h.length){var l=msgTools.create(h);f.insertBefore(l,f.firstChild);lnkd[g]=l}})(messages.getData(g),g)}Emotes.load();if(config.nq&&document.getElementsByClassName)for(d=document.getElementsByClassName("nme"),f=0;f<d.length;f++)d[f].parentElement&&
"A"!==d[f].parentElement.tagName&&d[f].textContent&&(d[f].onclick=function(a){return function(b){if(a&&a.textContent){b=a.textContent;var c=a.parentElement&&1*a.parentElement.getAttribute("data-uid");c?insertAtCaret("<@"+c+"|"+b+">"):insertAtCaret("<@"+b+">")}}}(d[f]));d=document.getElementById("messages").getElementsByClassName("bbImg");for(f=0;f<d.length;f++)d[f].style.cursor="zoom-in",d[f].onclick=function(a){showFullImage(a.target.src)};cbx.autoScroll(!1)};
cbx.ban=function(a,b){var c=cbx.$frm,e=makeCtxmenu(),d=function(b){e.hide();b.ref&&cbx.xhr("delban",{n:c.nme.value,k:c.key.value,ban:a,dur:b.ref},null,function(a,b){b?statusBar.warn(b):a&&(a=a.split("\t"),a[1]&&statusBar.set(a[1]))})};e.add(makeButton("Clock","Ban for a week","",d,"",604800).enable().element());e.add(makeButton("Clock","Ban for a day","",d,"",86400).enable().element());e.add(makeButton("Clock","Ban for an hour","",d,"",3600).enable().element());e.add(makeButton("Clock","Ban for 5 minutes",
"",d,"",300).enable().element());e.add(makeButton("Cancel","Cancel","",d,"",0).enable().element());e.show(b)};cbx.del=function(a){var b=cbx.$frm;cbx.xhr("delban",{n:b.nme.value,k:b.key.value,del:a},null,function(a,b){b?statusBar.warn(b):a&&cbx.del_proc(a,a)})};
cbx.del_proc=function(a,b){isNaN(b)&&(b=a);if(isNaN(a))return!1;var c=Math.min(a,b);a=Math.max(b,a);b=messages.getAll();for(var e=0,d=0;d<b.length;d++){var f=b[d],g=messages.getData(f);if(!g.isDeleted&&g.id>=1*c&&g.id<=1*a)for(classToggle(f,"Deleted",!0),e++,g=0;g<unreadMessages.length;g++)if(unreadMessages[g]==f){unreadMessages.splice(g,1);break}}window.setTimeout(function(){for(var a=document.querySelectorAll("#messages > .msg.Deleted"),b=0;b<a.length;b++)a[b].parentNode.removeChild(a[b])},500);
return e};cbx.proc_rpc_del=function(a){a=a.split(",");for(var b,c,e=0;e<a.length;e++)0>a[e].indexOf("_")?(b=parseInt(a[e],10),isNaN(b)||cbx.del_proc(b,b)):(c=a[e].split("_"),b=parseInt(c[0],10),c=parseInt(c[1],10),isNaN(b)||isNaN(c)||cbx.del_proc(b,c))};
var updateFavicon=function(){var a=document.createElement("canvas"),b=document.createElement("link");if(!a.getContext)return function(){};var c=a.getContext("2d");a.height=a.width=48;var e=function(){for(var a=document.getElementsByTagName("link"),b=0;b<a.length;b++){var c=a[b].getAttribute("rel");if(c&&c.match(/icon/))return c=a[b].href,a[b].parentElement.removeChild(a[b]),c}},d=!1,f=new Image;f.onload=function(){d=!0};f.crossOrigin="anonymous";f.src=e();return function(g){if(!isNaN(g)){c.font='bold 32px "Helvetica", "Tahoma", sans-serif';
c.clearRect(0,0,a.width,a.height);d&&(c.save(),c.scale(1/(f.width/a.width),1/(f.height/a.height)),c.drawImage(f,0,0),c.restore());e();if(0<g){g=99>1*g?1*g:"99";var h=c.measureText(g);c.fillStyle="rgba(255, 255, 255, 0.8)";c.fillRect(a.width-h.width-2,a.height-32-2,h.width+2,34);c.fillStyle="#dd2211";c.textBaseline="top";c.fillText(g,a.width-h.width,a.height-32)}b.rel="icon";b.type="image/png";b.sizes="48x48";b.href=a.toDataURL("image/png");b.parentNode!==document.head&&document.head.appendChild(b)}}}(),
titleT=null,stitle=document.title;function titleflash(){if(cbx.isTopLevel&&!windowIsFocused){updateFavicon(messages.numSinceBookmark);var a="New message! - "+stitle,b=!1;document.title=a;titleT=window.setTimeout(function(){document.title=b?a:stitle;b=!b},2E3)}}
var loadSWF=function(a,b){function c(a,b){return'<param name="'+a+'" value="'+b+'">'}window.document.getElementsByTagName("html");var e={name:a,id:a,src:b,quality:"high",allowScriptAccess:"always",bgcolor:"#ffffff",pluginspage:"http://www.macromedia.com/go/getflashplayer",title:"FL",type:"application/x-shockwave-flash",hasPriority:"true",width:1,height:1};var d={position:"absolute",width:"8px",height:"8px",bottom:"0px",left:"-10px",overflow:"hidden","z-index":"10000"};var f="",g;for(g in e)f+=g+'="'+
e[g]+'" ';var h="";for(g in d)h+=g+": "+d[g]+"; ";b=['<object style="'+h+'" id="'+a+'" data="'+b+'" type="'+e.type+'" title="'+e.title+'" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,40,0">',c("movie",b),c("AllowScriptAccess",e.allowScriptAccess),c("quality",e.quality),c("bgcolor",e.bgcolor),c("hasPriority",e.hasPriority),"<embed "+f+">","</object>"].join("");e=document.getElementById("flash_"+a)||document.createElement("div");
e.id="flash_"+a;document.body.appendChild(e);e.innerHTML=b;return document[a]},audioPlay=function(a){},initAudio=function(a){if(config.sn){var b={volAll:20,volTag:100};config.sv&&(b.volAll=b.volTag=0);var c={0:"Mute",20:"Low",100:"High"},e=cbx.gsUser.get("audiovols");if(e)for(var d in b)"undefined"===typeof e[d]||0!=e[d]&&20!=e[d]&&100!=e[d]||(b[d]=1*e[d]);var f=function(){var a=0,c;for(c in b)a=Math.max(a,b[c]);return a};e=function(a){var d=a.ref;d=100==b[d]?b[d]=20:20==b[d]?b[d]=0:b[d]=100;a.icon("Volume"+
c[d]);cbx.audio.play(d);h.icon("Volume"+c[f()]);cbx.gsUser.set("audiovols",b)};var g=makeCtxmenu();g.add(makeButton("Volume"+c[b.volAll],"On new messages","",e,"","volAll").enable().element());g.add(makeButton("Volume"+c[b.volTag],"On @tagged messages","",e,"","volTag").enable().element());var h=makeButton("VolumeMute","","Notification options",function(a){g.show(a.element())},"btnVolume");h.icon("Volume"+c[f()]);h.enable();cbx.audio.setup(a);audioPlay=function(a){cbx.audio.play(b[a]||0)}}};
cbx.audio=function(){var a=function(a){cbx.debug.log(a,"AUDIO")};return{play:function(){a("Play called but not configured.")},setup:function(b){a("Setup called with "+b);var c=null,e=function(){window.soundManager={_externalInterfaceOK:function(d){a("SWF: ExternalInterface online! Version: "+d);window.setTimeout(function(){c._createSound("cbxsnd",1,!1)},100);window.setTimeout(function(){a("Flash: loading "+b+".mp3");c._load("cbxsnd",b+".mp3",!0,!1,!1)},500)},sounds:{cbxsnd:{_onload:function(b){b?
(a("SWF: Loaded - configuring for play."),cbx.audio.play=function(b){a("Flash play called at volume "+b);c._setVolume("cbxsnd",b);c._start("cbxsnd",1,0,!1)}):a("SWF: Load failed - not switching play")},_onfinish:function(){a("SWF: Got onfinish")}}}};cbx.audio.play=function(b){a("Play waiting on flash")};a("Attempting to load Flash object... at "+config.smuri);var c=loadSWF("SMswf",config.smuri)};if(!("Audio"in window))return a("No Audio object found - fast fallback."),e(),!1;var d=null;c=new Audio;
var f=function(b){window.clearTimeout(h);c?(a("Ready via '"+b.type+"'. Duration "+c.duration+"."),cbx.audio.play=function(b){c?d?a("Play ongoing."):0!=b&&(d=window.setTimeout(function(){a("Play timeout. Falling back.");e()},5E3),cbx.audio.playStart=(new Date).getTime(),c.volume=b/100,b=c.play(),"undefined"!==typeof b&&b.then(function(a){}).catch(function(b){a("Play error: "+b.message);window.clearTimeout(d);d=null})):a("Play fired by object destroyed")},c.removeEventListener("canplay",f,!1),c.removeEventListener("canplaythrough",
f,!1)):a("Ready fired but object destroyed.")},g=".ogg";c.canPlayType&&c.canPlayType('audio/ogg; codecs="vorbis"').replace(/no/,"")||(g=".mp3");a("Audio object created; chose "+g);var h=window.setTimeout(function(){a("Load timeout. Falling back.");c=null;e()},5E3);c.addEventListener("canplay",f,!1);c.addEventListener("canplaythrough",f,!1);c.addEventListener("error",function(b){a("Got error. Falling back");window.clearTimeout(h);d&&(window.clearTimeout(d),d=null);c=null;e()},!1);c.addEventListener("timeupdate",
function(b){c&&c.currentTime&&null!==d&&(a("Got play timeupdate: playback started."),window.clearTimeout(d),d=null)},!1);a("Setting source: "+b+g);c.setAttribute("src",b+g)}}}();
cbx.repl=function(){try{var a=window.localStorage}catch(p){}var b="repl:",c=0,e="xxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)}),d=function(a){if(a!==c&&(cbx.debug.log(c+"->"+a,"RP"),c=a,m.state=c,m.onstatechange))m.onstatechange(c)},f=0,g=function(){var g=(new Date).getTime(),h="",l=null;try{h=""+a.getItem(b+":master"),l=JSON.parse(h)}catch(q){}h=function(){try{a.setItem(b+":master",JSON.stringify({id:e,tme:g,state:c}))}catch(q){}};m.masterID=
null;l&&l.id?l.tme<g-2*(g-f)?(d(3),h()):2!==c&&1!==c||l.id===e||3!==l.state?l.id!==e?(m.masterID=l.id,d(4),n(null)):(d(2),h()):(d(2),h()):(d(1),h());f=g},h=0,k=null,l=!0,n=function(d){if(4===c){var e="",f={};if(d&&d.key){if(d.key!==b+":buffer")return;try{e=d.newValue,f=JSON.parse(e)||{}}catch(q){return}}else try{e=""+a.getItem(b+":buffer"),f=JSON.parse(e)||{}}catch(q){return}if(f&&f.pos!==k)if(k=f.pos,l)l=!1;else if("undefined"!==typeof f.msg&&m.onmessage)m.onmessage(f.msg)}},m={start:function(d){0<
c||"string"!==typeof d||1>d.length||(a?(b+=d,m.clientID=e,window.setTimeout(g,0),window.setInterval(g,3E3),window.addEventListener?(window.addEventListener("storage",n),window.addEventListener("unload",m.stop)):(window.document.attachEvent("onstorage",n),window.attachEvent("onunload",m.stop))):cbx.debug.log("No localStorage object - cookie policy?","RP"))},stop:function(){if(4!==c){try{a.removeItem(b+":master"),a.removeItem(b+":buffer")}catch(p){}d(0)}},onmessage:function(a){},sendmessage:function(d){if(4!==
c){h++;try{a.setItem(b+":buffer",JSON.stringify({msg:d,pos:e+h}))}catch(r){}}},pump:n,state:null,onstatechange:null,clientID:null,masterID:null};return m}();
cbx.addTypingHandler=function(){return function(a,b){var c="IDLE",e=null,d=null,f=0,g=null,h=function(a){c!==a&&(c=a,null!==d&&(window.clearTimeout(d),d=null),a=(new Date).getTime()-f,d=window.setTimeout(function(){e!==c&&(b("TYPING"==c?!0:!1),e=c);f=(new Date).getTime()},"TYPING"==c?2500:1E3>a?1E3-a:0))},k=function(){null!==g&&(window.clearTimeout(g),g=null);2>a.value.length?h("IDLE"):(h("TYPING"),g=window.setTimeout(function(){h("IDLE")},1500))};a.addEventListener?a.addEventListener("keyup",k,!1):
a.attachEvent&&a.attachEvent("onkeyup",k)}}();
var profileBtn=null,profileBtnSetup=function(){var a=overlay.create(lang[30],"Profile");a.body=document.getElementById("pgProfile");a.body.onsubmit=function(){overlay.switchTo();return!1};var b=makeButton("SignOut",lang[29],"",function(a){cbx.getUserStatus(!0,!1);overlay.switchTo()},"btnLogout").hide(),c=makeButton("Cancel","Remove picture","",function(a){cbx.$frm.pic.value="";e();d()},"btnDelAvatar").hide(),e=function(){var a=document.getElementById("imgContainer");a.innerHTML="";if(a&&cbx.$frm.pic&&
cbx.$frm.pic.value){var b=document.createElement("img");b.src=cbx.$frm.pic.value;a.appendChild(b);c.enable();return!0}a.innerHTML='<i class="ico Camera" style="font-size: 8em;">';return!1},d=function(){cbx.xhr("profile",{},{"do":"update",n:cbx.$frm.nme&&cbx.$frm.nme.value,k:cbx.$frm.key&&cbx.$frm.key.value,url:cbx.$frm.eml&&cbx.$frm.eml.value,pic:cbx.$frm.pic&&cbx.$frm.pic.value},function(a,b){})},f=function(){overlay.switchTo(a);b.hide();1<cbx.gsUser.get("lvl")&&b.enable();var f=document.getElementById("inpProfileURL");
f&&cbx.$frm.eml&&(f.value=cbx.$frm.eml.value,f.onchange=function(){cbx.$frm.eml.value=f.value;cbx.gsUser.set("eml",f.value);d()});if(config.av){e();var h=makeButton("Upload","Change picture","",null,"btnAvatar");window.UploaderReady=function(a){a=a({authKey:config.img_key,authUser:config.img_usr,authApp:"cbox",maxFileSize:1E6,onevent:function(a,b){cbx.debug.log("Event "+a+": "+b,"UPLOAD");"done"==a&&(cbx.$frm.pic.value="https://"+b,cbx.gsUser.set("pic","https://"+b),d(),e(),h.enable(),c.enable(),
statusBar.hide());"error"==a&&statusBar.warn(b);"uploading"==a&&(h.disable(),c.disable(),statusBar.set("Uploading..."));"progress"==a&&statusBar.set("Uploading... "+10*Math.ceil(100*b/10)+"%")}});h.enable().element().appendChild(a)};(function(a,b,c){var d=a.getElementsByTagName(b)[0];a.getElementById(c)||(a=a.createElement(b),a.id=c,a.src="https://cbox.im/imgs/uploader2.js?115",d.parentNode.insertBefore(a,d))})(document,"script","cbox-uploader")}};profileBtn=makeButton("User","",lang[30],function(){config.uo||
f()},"btnUser");profileBtn.enable()},authBtnExtern=null;cbx.getUserStatus=null;
var authBtnSetup=function(){var a=overlay.create(lang[31],"Auth"),b=function(b,d,e){k();overlay.switchTo(a);var f=a.body,g=document.getElementById("authForm");f.innerHTML="";f.appendChild(g);(f=g.getElementsByTagName("INPUT"))&&f[0]&&f[0].focus();f=["Show"];f.push("login"==b?"Login":"Reg");makeButton("SignIn","login"==b?lang[27]:lang[28],"",function(a){g.onsubmit()},"authSubmit").enable();-1<d.indexOf("pw")&&f.push("WithPW");-1<d.indexOf("fb")&&f.push("WithFB");g.className=f.join(" ");var h="",l=
"";-1<d.indexOf("fb")&&fbLoginSetup("btnLoginFB",function(a){h="fb";l=a;g.onsubmit()});var m=cbx.$frm.nme.value,n=cbx.$frm.key.value;document.getElementById("authMsg").textContent=e||"";g.onsubmit=function(){for(var a={n:m,k:n,pword:g.pword.value,pword2:g.pword2.value,auth_prov:h,auth_id:l,"do":b},d=0;d<g.elements.length;d++)g.elements[d].value="";cbx.xhr("profile",{json:1},a,function(a,b){b?statusBar.warn(b):(a=JSON.parse(a),a.error?statusBar.warn(a.error):"LOGGED_IN"!=a.state?(overlay.switchTo(),
statusBar.warn("Unknown error. Please try again.")):(a.udata&&cbx.updateUser(a.udata),overlay.switchTo(),c()))});return!1}},c=function(){profileBtn.text(h.value);h.style.display="none";g.hide();cbx.autoScroll(!1)},e=function(a,d){if(h&&h.value.length){var f=h.value,l={LOGGED_IN:function(a,b){c()},LOGGED_OUT:function(){profileBtn.text("");h.style.display="";g.enable();cbx.autoScroll(!1);cbx.updateUser({key:"",lvl:1})},NAME_COLLISION:function(a,c){if(d)b("login",a,c);else g.onclick(function(){f!==h.value?
e(!1,!0):b("login",a,c)})},CAN_REGISTER:function(a,c){if(d)b("register",a,c);else g.onclick(function(){f!==h.value?e(!1,!0):b("register",a,c)})},CANNOT_REGISTER:function(a){g.disable();d&&statusBar.warn("You must log in, but cannot register this name. Please contact the administrator.")}},k=cbx.$frm;k={n:k.nme.value,k:k.key.value,"do":"query"};a&&(k["do"]="logout");g.disable();cbx.xhr("profile",{json:1},k,function(a,b){g.enable();b?cbx.debug.log(b,"AUTH"):(a=JSON.parse(a),cbx.debug.log(a.state,"AUTH"),
l[a.state]&&(a.udata&&a.udata.lvl&&cbx.updateUser({lvl:a.udata.lvl,uid:a.udata.uid}),l[a.state](a.auth_methods,a.message.replace(/%s/,cbx.$frm.nme.value),a.udata)))})}};cbx.getUserStatus=e;var d=null,f=cbx.$frm.nme;var g=makeButton("SignIn","",lang[31],function(){e(!1,!0)},"btnProfile");var h=f;h.value&&cbx.$frm.key.value&&1<cbx.gsUser.get("lvl")&&c();h.value&&window.setTimeout(function(){e(!1,!1)},400);var k=function(){null!==d&&(window.clearTimeout(d),d=null)};h.onchange=function(){k();""==h.value?
g.disable():d=window.setTimeout(function(){e(!1,!1)},500)};h.onkeydown=function(a){if(a&&9==a.keyCode)return a.preventDefault&&a.preventDefault(),cbx.$frm.pst.focus(),!1;if(a&&13==a.keyCode){a.preventDefault&&a.preventDefault();if(cbx.$frm.pst.value)return do_post(),!1;e(!1,!0);return!1}};authBtnExtern=function(){e(!1,!0)};h.onkeyup=function(a){k();""==h.value?g.disable():d=window.setTimeout(function(){e(!1,!1)},500)}},fbLoginSetup=function(){var a=function(a){cbx.debug.log(a,"FBBTN")},b=null,c=null,
e=!1,d=!1,f=function(d){var g=window.FB;a("Got login status: "+d.status);document.getElementById(b).className="btnAuthFB Interactive";if("connected"!==d.status)document.getElementById(b).onclick=function(){e=!0;a("Doing login...");g.login(f,{scope:"public_profile,email",return_scopes:!0})};else{var k=function(){document.getElementById(b).className="btnAuthFB Loading";document.getElementById(b).onclick=function(){};a("Got access token");c(d.authResponse.accessToken)};document.getElementById(b).onclick=
function(){e=!0;k()};e&&k()}};return function(g,h){var k=window.FB;b=g;c=h;d?(e=!1,document.getElementById(b).onclick=null,document.getElementById(b).className="btnAuthFB Loading",k.getLoginStatus(f)):(a("Loading FB lib..."),document.getElementById(b).className="btnAuthFB Loading",function(a,b,c){var d=a.getElementsByTagName(b)[0];a.getElementById(c)||(a=a.createElement(b),a.id=c,a.src="https://connect.facebook.net/en_US/sdk.js",d.parentNode.insertBefore(a,d))}(document,"script","facebook-jssdk"),
window.fbAsyncInit=function(){k=window.FB;a("Got FB init; awaiting login status");d=!0;k.init({appId:"701215030022299",cookie:!1,xfbml:!1,version:"v2.2"});k.getLoginStatus(f)})}}(),Blank=function(){try{var a=window.localStorage}catch(d){}var b="blank:",c=function(){window.location="about:blank";window.onerror=null;throw Error("Blanked");},e=function(c){try{if(c){var d=JSON.stringify(c);a.setItem(b,d)}else a.removeItem(b)}catch(g){}};return{init:function(d){b+=d;d={};try{var f=a.getItem(b);f&&(d=JSON.parse(f))}catch(g){}1*
d.expire>(new Date).getTime()?c():e(null)},set:function(a){0<1*a&&(a=Math.min(a,604800),e({expire:(new Date).getTime()+1E3*a}));c()}}}(),userViewMon=function(){var a={state:"",onstatechange:null},b=null,c=null,e=function(d){d!==c&&(c=d,null!==b&&(window.clearTimeout(b),b=null),b=window.setTimeout(function(){if(c!=a.state&&(a.state=c,"function"===typeof a.onstatechange))a.onstatechange(a.state,a.props)},"ACTIVE"==c?800:2400))},d={},f=function(b,c){if(d[b]!==c){d[b]=c;a.props=d;b="IDLE";d.dimensioned&&
d.hidden&&(b="BACKGROUND");if(d.hover||d.focus)b="ACTIVE";e(b)}},g=function(a){a.target===document.documentElement&&f("hover","mouseover"==a.type||"mouseenter"==a.type)},h=function(){var a=document.hasFocus();f("focus",a)},k=function(){f("hidden","hidden"==document.visibilityState)},l=function(){var a=document.documentElement.clientHeight;f("dimensioned",!(!document.documentElement.clientWidth||!a))},n=function(a,b,c){a.addEventListener?a.addEventListener(b,c,{passive:!0,capture:!1}):a.attachEvent&&
a.attachEvent("on"+b,c)};a.init=function(b){n(window,"resize",l);n(window,"resize",l);n(document,"visibilitychange",k);var c=document.documentElement;c&&(n(c,"mouseenter",g),n(c,"mouseleave",g));n(window,"focus",h);n(window,"blur",h);k();h();l();f("istop",window===window.parent);a.onstatechange=b};return a}();window.do_refresh=do_refresh;window.do_post=do_post;window.CBXINIT?window.CBXINIT(init):window.CBXINIT=init;
